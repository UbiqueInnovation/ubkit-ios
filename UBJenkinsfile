pipeline {
	agent none
	stages {
		stage("Install dependencies") {
			when { anyOf { branch 'master'; branch 'develop' } }
			agent {
				label"ios"
			}
			steps {
				sh "gem install jazzy"
			}
		}
		stage("Create Documentation") {
			when { anyOf { branch 'master'; branch 'develop' } }
			agent {
				label"ios"
			}
			steps {
				sh "fastlane documentation"
				sshagent(credentials: ['ub_docs']) {
					sh "ssh -o StrictHostKeyChecking=no core@192.168.178.46 'rm -fr /data/html/doc.ubique.ch/ubfoundation/${env.BRANCH_NAME}'"
					sh "scp -o StrictHostKeyChecking=no -r ./Documentation/html core@192.168.178.46:/data/html/doc.ubique.ch/ubfoundation/${env.BRANCH_NAME}"
				}
			}
		}
		stage("Run Tests") {
			agent {
				label "ios"
			}
			steps {
				sh "fastlane tests"
			}
			post {
				always {
					junit "fastlane/test_output/*.junit"
				}
			}
		}
	}
}

