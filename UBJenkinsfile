pipeline {
	agent none
	stages {
		stage("Install dependencies") {
			agent {
				label"ios"
			}
			steps {
				sh "gem install jazzy"
			}
		}
		stage("Create Documentation") {
			agent {
				label"ios"
			}
			steps {
				sh "fastlane documentation generate:true"
				publishHTML (target: [
					allowMissing: false,
					alwaysLinkToLastBuild: false,
					keepAll: true, 
					reportDir: 'Documentation/html',
					reportFiles: 'index.html',
					reportName: "Documentation"
				])
			}
		}
		stage("Run Tests") {
			agent {
				label "ios"
			}
			steps {
				sh "fastlane tests"
				publishHTML (target: [
					allowMissing: false,
					alwaysLinkToLastBuild: false,
					keepAll: true, 
					reportDir: 'fastlane/test_output',
					reportFiles: 'report.html',
					reportName: "Test Results"
				])
			}
		}
	}
}

